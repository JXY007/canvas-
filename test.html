<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<style type="text/css">
			#canvas{
				background: #000;
				margin: 100px auto;
				display: block;
			}
		</style>
	</head>
	<body>
		<canvas id="canvas" width="800" height="500"></canvas>
		<script type="text/javascript">
			function random( min, max ) {
				return Math.random() * ( max - min ) + min;
			}
			var num=30;
			while (num--){
				console.log(random( 0, Math.PI*2));
			}
			//~~的作用是相当于Math.floor()
			function rnd(minn,maxn){
				return Math.random() * ( maxn - minn ) + minn;
			}
////			for (var i=0;i<3;i++) {
////				alert(i);
////			}
//			for(var j=0;j<2;j++){
//				alert(j);
//			}
//			function drawCanvas(){
//				var canvas=document.getElementById("canvas");
//				var context=canvas.getContext('2d');
//				context.fillStyle='#fff';
//				context.beginPath();
//				context.arc(50,50,10,0,Math.PI*2,true);
//				context.fill();
//				context.closePath();
//			}


			var prarticles=[];
			var canvas=document.getElementById("canvas");
			var context=canvas.getContext('2d');
			var cw=canvas.width;
			var ch=canvas.height;
			function Particle(tx,ty){
				this.x=tx;
				this.y=ty;
				this.coordinates=[];
				this.coordinatesCount=5;
				while (this.coordinatesCount--){
					this.coordinates.push([this.x,this.y]);
				}
				this.angle=rnd(0,Math.PI*2);
				this.speed=rnd(1,10);
				this.gravity=1;
				//每一个Particle对象的颜色
				this.hue = rnd( 50, 150 );
				this.brightness = rnd( 50, 80 );
				this.alpha = 1;
				//透明度递减量
				//this.decay=randInt(0.015, 0.03);
				this.decay=0.01;
				this.friction=0.95;
			}
			Particle.prototype.updata=function(index){
				this.coordinates.pop();
				this.coordinates.unshift([this.x,this.y]);
				this.speed*=this.friction;
				/////////////////////////////////此处重点
//				this.x += Math.cos( this.angle ) * this.speed;
//
//				this.y += Math.sin( this.angle ) * this.speed + this.gravity;

				this.x += Math.cos( this.angle ) * this.speed;
				this.y += Math.sin( this.angle ) * this.speed + this.gravity;
				this.alpha -= this.decay;
				if( this.alpha <= this.decay ) {
					prarticles.splice(index, 1);
				}
			}
			Particle.prototype.draw=function(){
				context.beginPath();
				context.moveTo(this.coordinates[this.coordinates.length-1][0],this.coordinates[this.coordinates.length-1][1]);
				context.lineTo(this.x,this.y);
				context.strokeStyle='hsla(' + this.hue + ', 100%, ' + this.brightness + '%, ' + this.alpha + ')';
				context.lineWidth=2;
				context.stroke();
				context.closePath();
			}
			//flower操作函数
			function createParticle(x,y){
				var num=30;
				while (num--){
					prarticles.push(new Particle(x,y));	
				}
			}
			function particleDraw(){
				context.clearRect(0,0,cw,ch);
				var len=prarticles.length;
				while (len--){
					prarticles[len].draw();
					prarticles[len].updata(len);
				}
			}
			function playgo(){
				requestAnimationFrame(playgo);
				createParticle(rnd(30,cw-30),rnd(30,ch-40));
				particleDraw();
			}
			playgo();
			///////////////////////
			function Particle(tx,ty){
				this.x=tx;
				this.y=ty;
				this.coordinates=[];
				this.coordinatesCount=5;
				while (this.coordinatesCount--){
					this.coordinates.push([this.x,this.y]);
				}
				this.angle=randInt(0,Math.PI*2);
				this.speed=rand(1,10);
				this.gravity=1;
				//每一个Particle对象的颜色
				this.hue = rand( 50, 150 );
				this.brightness = rand( 50, 80 );
				this.alpha = 1;
				//透明度递减量
				//this.decay=randInt(0.015, 0.03);
				this.decay=0.01;
				this.friction=0.95;
			}
			Particle.prototype.updata=function(index){
				this.coordinates.pop();
				this.coordinates.unshift([this.x,this.y]);
				this.speed*=this.friction;

				this.x += Math.cos( this.angle ) * this.speed;
				this.y += Math.sin( this.angle ) * this.speed + this.gravity;
				this.alpha -= this.decay;
				if( this.alpha <= this.decay ) {
					prarticles.splice(index, 1);
				}
			}
			Particle.prototype.draw=function(){
				context.beginPath();
				context.moveTo(this.coordinates[this.coordinates.length-1][0],this.coordinates[this.coordinates.length-1][1]);
				context.lineTo(this.x,this.y);
				context.strokeStyle='hsla(' + this.hue + ', 100%, ' + this.brightness + '%, ' + this.alpha + ')';
				context.lineWidth=2;
				context.stroke();
				context.closePath();
			}
			//flower操作函数
			function createParticle(x,y){
				var num=30;
				while (num--){
					prarticles.push(new Particle(x,y));	
				}
			}
			function particleDraw(){
				var len=prarticles.length;
				while (len--){
					prarticles[len].draw();
					prarticles[len].updata(len);
				}
			}s
		</script>
	</body>
</html>
